<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/stylesheets/showEdit.css" />
<link rel="stylesheet" href="/stylesheets/style.css">
  <title><%= post.title %></title>
</head>
<body>
  <%- include('../partials/_navbar.ejs') %>

  <div class= "show-page-container">
    <% if (post.category !== 'quote' && post.image) { %>
      <div class="show-img">
        <img src="data:image/jpeg;base64,<%= post.image %>"  alt="<%= post.title %>"/>
      </div>
    <% } %>

    <div class= "show-info-container">
      <div class="show-header">
        <h1><%= post.title %></h1>
        <h3>Category: <%= post.category %></h3>
      </div>

      <div class= "show-details-container">
        <h3>By:
        <%= post.creator.username %>
        </h3>
        <p> <%= post.description %></p>
      </div>

      <div class="likes-container">
        <div class="likes-count">
          <h3> <%= post.likedBy.length %> Likes</h3>
        </div>

        <% if (user) { %>
          <div class="like-btn-container">
            <%if (userHasLiked) { %>
            <form action="/posts/<%= post._id %>/likes/<%= user._id %>?_method=DELETE" method="POST">
              <button class="round-btn like-btn liked" type="submit">
                <span class="heart-icon"></span> Unlike
              </button>
            </form>
            <% } else { %>
            <form action="/posts/<%= post._id %>/likes/<%= user._id %>" method="POST">
              <button class="round-btn like-btn" type="submit">
                          <span class="heart-icon"></span>Like
              </button>
            </form>
            <% } %>
          </div>
        <% } else { %>
          <p>Log in to like this post.</p>
        <% } %>
      </div>

      <div class="comments-container">
          <form action="/posts/<%= post._id %>/comments" method="POST">
    <input type="text" name="description" id="description" class="comment-input" placeholder="Write a comment">
    <button type="submit" class="comment-btn">Add comment</button>
    </form>


    <div class="comments-list">
    <% postComments.forEach(comment => { %>
      <div class="comment-card">

        <div class="comment-header">
          <h5 class="comment-author"><%= comment.userID.username %></h5>
        </div>

        <p class="comment-text">
          <%= comment.description %>
        </p>


        <% if(comment.userID._id.equals(user._id)) { %>
          <form
            action="/posts/<%= comment.postID._id %>/comments/<%= comment._id %>?_method=DELETE"
            method="POST"
            class="delete-comment-form"
          >
            <button type="submit" class="delete-comment-btn">Delete</button>
          </form>
        <% } %>
    </div>
  <% }); %>

          </div>
      <% if (post.creator._id.equals(user._id)) { %>
      <div class="creator-container" style="margin-top: 10px;">
        <a href="/posts/<%= post._id %>/edit">Edit</a>
        <form action="/posts/<%= post._id %>?_method=DELETE" method="POST">
          <button type="submit">Delete</button>
        </form>
      <% } %>
      </div>
      </div>
    </div>
  </div>
</body>
</html>
